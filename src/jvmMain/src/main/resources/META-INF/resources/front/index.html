<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <title>Live Tracker</title>
    <script type="text/javascript" src="elm.js"></script>
</head>

<body>
<div id="live-tracker"></div>
</body>

<script type="text/javascript">

    // Start the Elm application.
    let app = Elm.Main.init({
        node: document.getElementById('live-tracker')
    });

    console.log(app);

    let socket = new WebSocket('ws://localhost:8080/api/comments/validation');

    // When a command goes to the `sendMessage` port, we pass the message
    // along to the WebSocket.
    app.ports.sendMessage.subscribe(message => socket.send(JSON.stringify(message)));
    // When a message comes into our WebSocket, we pass the message along
    // to the `messageReceiver` port.
    socket.onmessage = (ev => {
        let incomingValue = JSON.parse(ev.data);
        app.ports.messageReceiver.send(incomingValue);
    })
    // Also monitor errors
    socket.onerror = (ev => console.error(ev.data))

    app.ports.clipboardCopy.subscribe(name => navigator.clipboard.writeText(name))
</script>

</html>
